!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mhtml2html=t():e.mhtml2html=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){const r=n(3),o=n(4);function a(e,t){if(!e)throw new Error(t);return!0}function i(e){return a("undefined"!=typeof DOMParser,"No DOM parser available"),{window:{document:(new DOMParser).parseFromString(e,"text/html")}}}function c(e,t){if(0===t.indexOf("http://")||0===t.indexOf("https://"))return t;const n=e.split("/"),r=t.split("/");n.pop();for(let e=0;e<r.length;e++)"."!=r[e]&&(".."==r[e]?n.pop():n.push(r[e]));return n.join("/")}function s(e){const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0,r=e.length;t<r;t++)n[t]=e.charCodeAt(t);return t}function d(e,t,n){let r,a;for(a=0;(a=n.indexOf("url(",a))>0;a+=r.length){a+="url(".length;const i=c(t,(r=n.substring(a,n.indexOf(")",a))).replace(/(\"|\')/g,""));if(null!=e[i]){"text/css"===e[i].type&&(e[i].data=d(e,t,e[i].data));try{const t=`'data:${e[i].type};base64,${"base64"===e[i].encoding?e[i].data:o.encode(e[i].data)}'`;n=`${n.substring(0,a)}${t}${n.substring(a+r.length)}`}catch(e){console.warn(e)}}}return n}function l(e){switch(e.encoding){case"quoted-printable":return`data:${e.type};utf8,${escape(r.decode(e.data))}`;case"base64":return`data:${e.type};base64,${e.data}`;default:return`data:${e.type};base64,${o.encode(e.data)}`}}const u={parse:(e,{htmlOnly:t=!1,parseDOM:n=i}={})=>{const o=0,c=1,d=2,l=3;let u,f,p,h,g,m,y,b,v,x,$,w,A,T,C,M,F;function O(){for(;a(C<u.length-1,"Unexpected EOF")&&/\s/.test(u[C]);)"\n"==u[++C]&&M++}function E(e){const t=C;for(;"\n"!==u[C]&&a(C++<u.length-1,"Unexpected EOF"););C++,M++;const n=u.substring(t,C);return"quoted-printable"===e?r.decode(n):"base64"===e?n.trim():n}function L(e,t){const n=e.indexOf(":");n>-1?t[w=e.substring(0,n).trim()]=e.substring(n+1,e.length).trim():(a(void 0!==w,`Missing MHTML headers; Line ${M}`),t[w]+=e.trim())}for(u=e.replace("\r\nThis is a multi-part message in MIME format.",""),p={},h={},g={},m={},$=o,C=M=0;$!=l;)switch($){case o:if(0!=(A=E())&&"\n"!=A)L(A,p);else{a(void 0!==p["Content-Type"],`Missing document content type; Line ${M}`);const e=p["Content-Type"].match(/boundary=([^;]+)/m);a(null!=e,`Missing boundary from document headers; Line ${M}`),F=e[1].replace(/\"/g,""),O(),a((A=E()).trim().includes(F),`Expected boundary; Line ${M}`),h={},$=c}break;case c:0!=(A=E())&&"\n"!=A?L(A,h):(b=h["Content-Transfer-Encoding"],v=h["Content-Type"],x=h["Content-ID"],y=h["Content-Location"],void 0===T&&a(void 0!==(T=y)&&v.startsWith("text/html"),`Index not found; Line ${M}`),a(void 0!==x||void 0!==y,`ID or location header not provided;  Line ${M}`),a(void 0!==b,`Content-Transfer-Encoding not provided;  Line ${M}`),a(void 0!==v,`Content-Type not provided; Line ${M}`),f={encoding:b,type:v,data:"",id:x},void 0!==x&&(m[x]=f),void 0!==y&&void 0===g[y]&&(g[y]=f),O(),h={},$=d);break;case d:{for(A=E(b);!A.includes(F);)f.data+=A,A=E(b);let e=f.data;try{f.data=decodeURIComponent(escape(f.data))}catch(t){console.warn(`Initial decoding failed for asset (Type: ${f.type}, ID: ${f.id}, Location: ${y}). `+`Attempting fallback. Error: ${t.message}`);let n=null,r=null;try{const t=(f.type||"").match(/charset=([^;]+)/i);if(t&&(n=t[1].trim().replace(/"/g,""),r="part header"),!n&&p["Content-Type"]){const e=(p["Content-Type"]||"").match(/charset=([^;]+)/i);e&&(n=e[1].trim(),r="main header")}if(!n&&y===T){console.log("No charset in headers, attempting to find meta tag in main HTML.");const t=/<meta\s+.*?charset\s*=\s*["']?([^"'>\s]+)/i,o=new RegExp("<meta\\s+http-equiv\\s*=\\s*[\"']?Content-Type[\"']?\\s+content\\s*=\\s*[\"']?[^\"'>]+;\\s*charset=([^\"'>\\s]+)","i");let a=e.match(t)||e.match(o);a&&a[1]?(n=a[1].trim(),r="meta tag",console.log(`Found charset '${n}' in meta tag.`)):console.log("No charset meta tag found in main HTML.")}if(n&&"undefined"!=typeof TextDecoder){console.log(`Attempting decoding with charset '${n}' from ${r}.`);const t=new TextDecoder(n,{fatal:!0}),o=s(e);f.data=t.decode(o),console.log(`Successfully decoded with charset: ${n}`)}else n?(console.warn(`TextDecoder API not available, cannot decode with charset '${n}' from ${r}.`),f.data=e):(console.warn("No charset specified in headers or meta tag, cannot apply fallback decoding."),f.data=e)}catch(t){console.error(`Fallback decoding failed for asset (Type: ${f.type}, ID: ${f.id}, Loc: ${y}). `+`Charset: ${n} (from ${r}). Error: ${t.message}`),f.data=e}}if(!0===t&&void 0!==T)return n(f.data);$=C>=u.length-1?l:c;break}}return{frames:m,media:g,index:T}},convert:(e,{convertIframes:t=!1,parseDOM:n=i}={})=>{let r,o,c,s,f,p,h,g;"string"==typeof e?e=u.parse(e):a("object"==typeof e,"Expected argument of type string or object"),c=e.frames,o=e.media,r=e.index,a("object"==typeof c,"MHTML error: invalid frames"),a("object"==typeof o,"MHTML error: invalid media"),a("string"==typeof r,"MHTML error: invalid index"),a(o[r]&&o[r].type.startsWith("text/html"),"MHTML error: invalid index");const m=n(o[r].data),y=m.window.document,b=y.querySelector("meta[charset]");if(b)b.setAttribute("charset","UTF-8");else{const e=y.querySelector("head");if(e){const t=y.createElement("meta");t.setAttribute("charset","UTF-8"),e.insertBefore(t,e.firstChild)}}const v=[y];for(;v.length;){const e=v.shift();e.childNodes.forEach(function(a){switch(a.getAttribute&&(h=a.getAttribute("href"),g=a.getAttribute("src")),a.removeAttribute&&a.removeAttribute("integrity"),a.tagName){case"HEAD":(f=y.createElement("base")).setAttribute("target","_parent"),a.insertBefore(f,a.firstChild);break;case"LINK":void 0!==o[h]&&"text/css"===o[h].type&&((s=y.createElement("style")).type="text/css",o[h].data=d(o,h,o[h].data),s.appendChild(y.createTextNode(o[h].data)),e.replaceChild(s,a));break;case"STYLE":(s=y.createElement("style")).type="text/css",s.appendChild(y.createTextNode(d(o,r,a.innerHTML))),e.replaceChild(s,a);break;case"IMG":if(p=null,void 0!==o[g]&&o[g].type.includes("image")){try{p=l(o[g])}catch(e){console.warn(e)}null!==p&&a.setAttribute("src",p)}a.style.cssText=d(o,r,a.style.cssText);break;case"IFRAME":if(!0===t&&g){const e=`<${g.split("cid:")[1]}>`,r=c[e];if(r&&"text/html"===r.type){const i=u.convert({media:Object.assign({},o,{[e]:r}),frames:c,index:e},{convertIframes:t,parseDOM:n});a.src=`data:text/html;charset=utf-8,${encodeURIComponent(i.window.document.documentElement.outerHTML)}`}}break;default:a.style&&(a.style.cssText=d(o,r,a.style.cssText))}v.push(a)})}return m}};e.exports=u},function(e,t,n){(function(e,r){var o;/*! https://mths.be/quoted-printable v1.0.1 by @mathias | MIT license */!function(a){var i=t,c=(e&&e.exports,"object"==typeof r&&r);c.global!==c&&c.window;var s=String.fromCharCode,d=function(e){return e.replace(/\x20$/,"=20").replace(/\t$/,"=09")},l=/[\0-\x08\n-\x1F=\x7F-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,u={encode:function(e){for(var t=e.replace(l,function(e){if(e>"ÿ")throw RangeError("`quotedPrintable.encode()` expects extended ASCII input only. Don’t forget to encode the input first using a character encoding like UTF-8.");return"="+("0"+e.charCodeAt(0).toString(16).toUpperCase()).slice(-2)}),n=t.split(/\r\n?|\n/g),r=-1,o=n.length,a=[];++r<o;)for(var i=75,c=0,s=n[r].length;c<s;){var u=t.slice(c,c+i);/=$/.test(u)?(u=u.slice(0,i-1),c+=i-1):/=[A-F0-9]$/.test(u)?(u=u.slice(0,i-2),c+=i-2):c+=i,a.push(u)}var f=u.length;return/[\t\x20]$/.test(u)&&(a.pop(),f+2<=i+1?a.push(d(u)):a.push(u.slice(0,f-1),d(u.slice(f-1,f)))),a.join("=\r\n")},decode:function(e){return e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,function(e,t){var n=parseInt(t,16);return s(n)})},version:"1.0.1"};void 0===(o=function(){return u}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(0)(e),n(1))},function(e,t,n){(function(e,r){var o;/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */!function(a){var i=t,c=(e&&e.exports,"object"==typeof r&&r);c.global!==c&&c.window;var s=function(e){this.message=e};(s.prototype=new Error).name="InvalidCharacterError";var d=function(e){throw new s(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,f={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&d("The string to be encoded contains characters outside of the Latin1 range.");for(var t,n,r,o,a=e.length%3,i="",c=-1,s=e.length-a;++c<s;)t=e.charCodeAt(c)<<16,n=e.charCodeAt(++c)<<8,r=e.charCodeAt(++c),i+=l.charAt((o=t+n+r)>>18&63)+l.charAt(o>>12&63)+l.charAt(o>>6&63)+l.charAt(63&o);return 2==a?(t=e.charCodeAt(c)<<8,n=e.charCodeAt(++c),i+=l.charAt((o=t+n)>>10)+l.charAt(o>>4&63)+l.charAt(o<<2&63)+"="):1==a&&(o=e.charCodeAt(c),i+=l.charAt(o>>2)+l.charAt(o<<4&63)+"=="),i},decode:function(e){var t=(e=String(e).replace(u,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&d("Invalid character: the string to be decoded is not correctly encoded.");for(var n,r,o=0,a="",i=-1;++i<t;)r=l.indexOf(e.charAt(i)),n=o%4?64*n+r:r,o++%4&&(a+=String.fromCharCode(255&n>>(-2*o&6)));return a},version:"0.1.0"};void 0===(o=function(){return f}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(0)(e),n(1))}])});
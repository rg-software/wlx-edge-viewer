<html>
  <head>
	  <meta charset="utf-8"/>
	  <base href=http://local.example/__BASE_URL__/>
    <link rel="stylesheet" href="http://assets.example/markdown/__CSS_NAME__">
    <link rel="stylesheet" href="http://assets.example/highlight_js/github.min.css">
    <link rel="stylesheet" href="http://assets.example/markdown/github.markdown.alert.css">
    <script src="http://assets.example/detect-charset.js"></script>
    <script src="http://assets.example/markdown/marked.umd.js"></script>
    <script src="http://assets.example/markdown/markdownExtension.js"></script>
    <script src="http://assets.example/highlight_js/highlight.min.js"></script>
    <script src="http://assets.example/mermaid/mermaid.min.js"></script>
    <script src="http://assets.example/mathjax/tex-svg.js"></script>
  </head>
  <body>
    <div id="content"></div>
    
    <script>
      const url = "http://local.example/__MD_FILENAME__"
      fetch(url).then( r => r.arrayBuffer() ).then(async t => 
        {
          const decoder = new TextDecoder(detect_charset(new Uint8Array(t)));

          marked.use({
            extensions: [markdownAlertExtension],
            renderer: customRenderer
          });

          const html = marked.parse(decoder.decode(t));
          document.getElementById('content').innerHTML = html;

          // ---- MathJax----
          try {
              MathJax.typeset();
          } catch(e) {
              console.log("MathJax error:", e);
          }

          // ---- Mermaid ----
          try {
              mermaid.initialize({ startOnLoad: false });
              await mermaid.run();
          } catch(e) {
              console.log("Mermaid error:", e);
          }

          // ---- highlight.js ----
          try {
              hljs.highlightAll();
          } catch(e) {
              console.log("highlight.js error:", e);
          }

        });
    </script>
  </body>
</html>
